更新履歴

2021/07/29 19:30
大量にあったよくわからんsedをawkを使って実装することで高速化と可読性の向上を行ったつもり。
コメントも少しばかりつけておいた。
今までのやつから流用できるところは流用したけどなるべく０から作ったつもり。
動画の変換についてはFFmpegが必要で、人によっては最新ビルドを使いたい人や特定のコーデックを使いたい人もいそうなのでやめた。
while分のところは繰り返しが多いのでそのうち関数化して短縮するかもしれない。

2021/07/31  (ただの日記)
複数ストリームを出力しようと無理やりhexdump と xxd でawbのヘッダーと中身のhcaを全部結合させる方法で実装してたがvgmstreamの-sオプションで事足りることが分かったのでアップロードをやめた。

2021/08/01 2:50
複数ストリーム出力を実装できました。
私の環境では「音声のみ」で実行すると16分20秒かかりました。
awbファイルの大きさに対して出力が少ないなと思いつつ目をそらしてしまっていました。
本当に申し訳ございませんでした……

2021/08/02 5:56
175 ID:7Gw3/tWIさんより報告頂いたバグを修正しました。
具体的にはrmにfオプションをつけたのと(すべてではない)、metaからリストを作成する関数が呼ばれてなかったので呼ぶようにしました。

2021/08/02 21:29
sqlite3へのパイプでインデントしているとエラーが出てしまうのでechoの拡張で対応した。

2021/08/12 02:47
「ライブだけ」を選択したとき「sound/」にあるファイルをすべて処理してしまっていたので、修正しました。

2021/08/12 03:57
ライブのID表がうまく出力されていなかったので修正しました。

2021/08/19 07:03
ご指摘のあったようにvgmstreamのインストール部分の
git clone --depth 1
の--depth1を消しました対応が遅れて申し訳ない。

2021/08/20 15:11
音声を変換するときawbのトラック数とすでにあるwavファイルの数を比べてそれが等しいならそのawbは変換しないようにした。

2021/08/21 22:14
whileでdircp回すところを関数化しました。
その結果可読性が下がりましたすみません(「'"hoge"'」のようになっている文字列を$1に入れることができなかったため)。
コピーの挙動をオプションで変えることができるようにしました。「uma.sh -h」でご確認ください。
コピー時や音声の処理時にスキップした数も表示するようにしました。

2021/08/23 00:54
ライブID表が正しく出力されていない問題を修正しました。

2021/08/24 01:09 (ただの日記)
「vgmstream CLI decoder r1626」にて内包されているストリームをすべて書き出すオプションなどが追加されましたが、旧バージョンを使っている人もいると思うのでしばらくは従来のやり方で出力しようと思います。

2021/08/24 08:05 (ただの日記)
Ubuntuの環境をどう構築したらいいかわからない人向けのコーナーを作っておいた。
悪評だったら消す。
夏休みが終わったら更新頻度がさらに低下する可能性がある。

2021/08/25 23:21
vgmstreamのインストールにcmakeを採用することにした。
fzfのインストールはaptではなくgithubからダウンロードすることにしました。

2021/08/26 05:19
vgmstreamの表記揺れに対応した。

2021/08/26 11:40
インストール周りで相手の意思問わずインストールしてしまうようになっていたので修正した。
変数名の間違いを修正した。

2021/08/30 00:31
GitHubにリポジトリを作ったのでアップデート機能を付けてみた。
./uma.sh -U でアップデートできます。
その際、uma.shというシンボリックリンク作るので、カスタマイズしたuma.shを作って置いているなら先に移動しておいてください。

2021/09/03 11:01
オプションで並列コピーを可能にした。
詳しくは
./uma.sh -h
で確認してほしい。
ただ、並列コピーをするとバックグラウンドで実行するためかコピーされた数やスキップされた数がうまく表示されないのでそこは無視してください。

2021/10/01 17:03
vgmstreamのインストール方法を各々でビルドする方法から公式が配布しているバイナリをダウンロード形にした。
気軽にissueって話はどっか行ったんすかね？スレ無駄に消費しちゃってごめんね。

2021/10/20 23:00
metaファイルに変更があった場合ファイルをコピーするときのフラグを変更するようにしました。

2021/12/16 23:05
meta内の音声ファイルのナンバリングが0000からだったのでそれに揃えるようにした。
そのためすでに音声をawbからデコードしている場合同一のファイルが別名で出力されてしまうので一旦sound_wavフォルダを削除するほうがいいかもしれません。ご迷惑おかけします……

2022/02/05 3:49
環境構築用のスクリプトを改良しました。